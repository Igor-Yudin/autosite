{% extends 'main/base.html' %}

{% load filters %}

{% load static %}

{% block javascript %}
	<script src="{% static 'js/input_content.js' %}"></script>
  <script>
    var pages_buff = {};
	  bound_buttons();
	  bound_checkboxes(pages_buff);
  </script>
{% endblock %}

{% block content %}
	<div class="content">
		<form method="POST" action="{% url 'input_content' pk=pk %}" enctype="multipart/form-data">
			{% csrf_token %}

			<input type="hidden" id="order" name="order" value="{{ order }}">

			<div id="pages">
				{% for page in pages %}
				  <div id="{{ page|concatenate:'_page' }}">
				  	<h1>{{ page|capfirst }}</h1>
				  	{{ forms|get_value:page |get_value_as_p:'general_form' }}

					  {% if page != 'main' and page != 'contact_form' %}
					  	<h2>{{ page|capfirst|concatenate:' :paragraphs' }}</h2>

				  		{% with formset=forms|get_value:page|get_value:'formset' %}
					  	<div id="{{ 'id_'|concatenate:page|concatenate:'_p_formset' }}">
					  		{{ formset|get_attr:'management_form' }}
					  		{% for f in formset|get_attr:'forms' %}
					  			<div>
					  				{{ f.as_p }}
					  			</div>
					  		{% endfor %}
					  	</div>

					  	<div id="{{ 'empty_'|concatenate:page }}" style="display: none">
					  		<div>
					  			{{ formset.empty_form.as_p }}
					  		</div>
					  	</div>
				  	  {% endwith %}
				  	  <input type="button" class="add-btn" value="Add" target="{{ page }}">
						  <input type="button" class="rmv-btn" value="Remove" target="{{ page }}">
					  {% endif %}
					</div>
				{% endfor %}
		  </div>

			<ul class="choosen-pages">
			  {% for page in pages %}
			    <li class="checkbox-wrapper">
				    <input type="checkbox" name="{{ page }}" checked>
			      <p class="page-label">{{ page }}</p>
			    </li>
			  {% endfor %}
			</ul>

			<button type="submit">OK</button>
		</form>
	</div>
{% endblock %}






















<!-- Not using code -->
{% block notparse %}
<div id="main_page">
					<h1>Главная</h1>
					{{ main_form.as_p }}
				</div>

				<div id="about_us_page">
					<h1>О нас</h1>
					{{ about_us_form.as_p }}

					<h2>О нас: параграфы</h2>

					<div id="id_about_us_p_formset">
						{{ about_us_formset.management_form }}
						{% for form in about_us_formset.forms %}
							<div>
							  {{ form.as_p }}
						  </div>
						{% endfor %}
					</div>

					<div id="empty_about_us" style="display: none">
						<div>
						  {{ about_us_formset.empty_form.as_p }}
						 </div>
					</div>

					<input type="button" class="add-btn" value="Add more" id="add_more_to_about_us" target="about_us">
					<input type="button" class="rmv-btn" value="Remove" id="remove_from_about_us" target="about_us">
				</div>

				<div id="catalog_page">
					<h1>Каталог</h1>
					{{ catalog_form.as_p }}

					<h2>Каталог: параграфы</h2>

					<div id="id_catalog_p_formset">
						{{ catalog_formset.management_form }}
						{% for form in catalog_formset.forms %}
							<div>
							  {{ form.as_p }}
							 </div>
						{% endfor %}
					</div>

					<div id="empty_catalog" style="display: none">
						<div>
							{{ catalog_formset.empty_form.as_p }}
						</div>
					</div>

					<input type="button" class="add-btn" value="Add more" id="add_more_to_catalog" target="catalog">
					<input type="button" class="rmv-btn" value="Remove" id="remove_from_about_us" target="catalog">
				</div>
			</div>

		<script>
			function addParagraph(e) {
				var btn = document.getElementById(e.target.id);
				var blockName = btn.parentNode.id;

				var div = document.createElement('div');
				var countField = document.getElementById(blockName + '-p-count')
				countField.value = parseInt(countField.value) + 1;
				var count = countField.value;

				div.id = blockName + "-p-" + count;
				div.className = "p";

				var lbl1 = document.createElement('label');
				lbl1.innerHTML = "Выберите рисунок для фона параграфа";
				lbl1.htmlFor = blockName + "-id-p-" + count + "-background";

				var lbl2 = document.createElement('label');
				lbl2.innerHTML = "Выберите картинку для данного параграфа";
				lbl2.htmlFor = blockName + "-id-p-" + count + "-image";

				var lbl3 = document.createElement('label');
				lbl3.innerHTML = "Введите загаловок параграфа";
				lbl3.htmlFor = blockName + "-id-p-" + count + "-header";

				var lbl4 = document.createElement('label');
				lbl4.innerHTML = "Введите текст параграфа";
				lbl4.htmlFor = blockName + "-id-p-" + count + "-text";

				var input1 = document.createElement('input');
				input1.type = "file";
				input1.name = blockName + "-p-" + count + "-background";
				input1.id = blockName + "-id-p-" + count + "-background";

				var input2 = document.createElement('input');
				input2.type = "file";
				input2.name = blockName + "-p-" + count + "-image";
				input2.id = blockName + "-id-p-" + count + "-image";
				
				var input3 = document.createElement('input');
				input3.type = "text";
				input3.name = blockName + "-p-" + count + "-header";
				input3.id = blockName + "-id-p-" + count + "-header";

				var input4 = document.createElement('textarea');
				input4.name = blockName + "-p-" + count + "-text";
				input4.id = blockName + "-id-p-" + count + "-text";

				div.appendChild(lbl1);
				div.appendChild(input1);

				div.appendChild(lbl2);
				div.appendChild(input2);

				div.appendChild(lbl3);
				div.appendChild(input3);

				div.appendChild(lbl4);
				div.appendChild(input4);

				id = "#" + e.target.id.toString();
				$(id).before(div);
			}
			function removeParagraph(e) {
				var blockName = e.target.parentNode.id;
				var countField = document.getElementById(blockName + "-p-count");

				count = parseInt(countField.value);

				var paragraph = document.getElementById(blockName + '-p-' + count);

				if (count == 0)
					return;

				paragraph.parentNode.removeChild(paragraph);

				countField.value = count - 1;
			}
		</script>
{% endblock %}